# i3 config file
# Last modification: 2016-06-07

####################
# GLOBAL VARIABLES
####################

# i3 config dir
set $i3 "$HOME/.dotfiles/i3"

# Keys
set $mod Mod4
set $alt Mod1

# Colors
set $bg #333333
set $bg_light #434343
set $sl #F3F3F3
set $blue #6793DB
set $red #CE3A3A
set $focused_txt #F6F6F6
set $inactive_txt #9D9D9D

# Outputs (Monitors)
set $monitor1 LVDS
set $monitor2 VGA-0

# Control volume with pactl
set $pactl_decrease exec pactl set-sink-volume 0 -- '-5%'
set $pactl_increase exec pactl set-sink-volume 0 -- '+5%'
set $pactl_mute exec pactl set-sink-mute 0 toggle

####################
# GLOBAL KEYBINDINGS
####################

# Mouse
bindsym --border button2 kill

# Exit i3
set $mode_exit [l]ogout | [s]hutdown | [r]eboot
bindsym $mod+shift+e mode "$mode_exit"
mode "$mode_exit" {
	bindsym l exec i3-msg exit
	bindsym s exec --no-startup-id sudo $i3/do.sh shutdown
	bindsym r exec --no-startup-id sudo $i3/do.sh reboot

	bindsym $mod+shift+e mode "default"
	bindsym Escape mode "default"
	bindsym Return mode "default"
}

# A custom mode for launching applications
set $mode_launcher  [w]eb-browser |  [m]ail |  [f]ile-manager |  g[v]im |  [t]erminal
bindsym $mod+Return mode "$mode_launcher"
mode "$mode_launcher" {
	bindsym w exec x-www-browser; mode "default"
	bindsym m exec exo-open --launch MailReader; mode "default"
	bindsym f exec exo-open --launch FileManager; mode "default"
	bindsym t exec i3-sensible-terminal; mode "default"
	bindsym v exec gvim; mode "default"

	bindsym $mod+Return mode "default"
	bindsym Escape mode "default"
	bindsym Return mode "default"
}

# A custom mode for layouts
set $mode_layout [s]tacking | [t]abbed | s[p]lit
bindsym $mod+e mode "$mode_layout"
mode "$mode_layout" {
	bindsym s layout stacking; mode "default"
	bindsym t layout tabbed; mode "default"
	bindsym p layout toggle split; mode "default"

	bindsym $mod+e mode "default"
	bindsym Escape mode "default"
	bindsym Return mode "default"
}

# dmenu
bindsym $mod+space exec j4-dmenu-desktop --dmenu="dmenu -i -l 10 -p '> ' -nb '$bg' -nf '$inactive_txt' -sb '$blue' -sf '$focused_txt'" --no-generic

# xkill
bindsym --release Control+Shift+Escape exec xkill

# cmus
bindsym Control+F12 exec --no-startup-id bash ~/Projects/Scripts/Multimedia/cmus-notify.sh "-u" && pkill -RTMIN+10 i3blocks
bindsym Control+F10 exec --no-startup-id bash ~/Projects/Scripts/Multimedia/cmus-notify.sh "-n" && pkill -RTMIN+10 i3blocks
bindsym Control+F11 exec --no-startup-id bash ~/Projects/Scripts/Multimedia/cmus-notify.sh "-r" && pkill -RTMIN+10 i3blocks

# Xfce tools
bindsym Print exec xfce4-screenshooter
bindsym $alt+F1 exec xfce4-appfinder

# Volume
bindsym $mod+Down $pactl_decrease
bindsym $mod+Up $pactl_increase
bindsym $mod+Shift+Down $pactl_mute

# Kill focused window
bindsym $mod+c kill

# Change focus
bindsym $mod+h focus left
bindsym $mod+j focus down
bindsym $mod+k focus up
bindsym $mod+l focus right

# Move focused window
bindsym $mod+Shift+h move left
bindsym $mod+Shift+j move down
bindsym $mod+Shift+k move up
bindsym $mod+Shift+l move right

# Split in horizontal/vertical orientation
bindsym $mod+v split h
bindsym $mod+s split v

# Fullscreen mode
bindsym $mod+f fullscreen

# Toggle tiling / floating
bindsym $mod+Shift+space floating toggle

# Change focus between tiling / floating windows
# bindsym $mod+space focus mode_toggle

# Focus the parent/child container
# bindsym $mod+q focus parent
# bindsym $mod+d focus child

# Reload the configuration file
bindsym $mod+Shift+c reload

# Restart i3 inplace
bindsym $mod+Shift+r restart

# Keep it for reference
# bindsym $mod+Shift+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -b 'Yes, exit i3' 'i3-msg exit'"

# Resize window
set $mode_resize resize h | l | j | k
bindsym $mod+r mode "$mode_resize"
mode "$mode_resize" {
	bindsym h resize shrink width 10 px or 10 ppt
	bindsym j resize grow height 10 px or 10 ppt
	bindsym k resize shrink height 10 px or 10 ppt
	bindsym l resize grow width 10 px or 10 ppt

	bindsym $mod+r mode "default"
	bindsym Return mode "default"
	bindsym Escape mode "default"
}

# Make the currently focused window a scratchpad
bindsym $mod+Shift+x move scratchpad
# Show the first scratchpad window
bindsym $mod+x scratchpad show

#########
# WINDOWS
#########

client.focused $blue $blue $sl $sl $blue
client.focused_inactive $bg $bg $inactive_txt $inactive_txt $bg
client.unfocused $bg $bg $inactive_txt $inactive_txt $bg
client.urgent $red $red $sl $red $red
client.placeholder $blue $blue $sl $sl $sl
client.background $blue

# hide_edge_borders both
font pango:Ubuntu Mono derivative Powerline 11

# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $mod
new_window pixel 3
mouse_warping none

# Enable floating mode for some windows
for_window [class="^Yad$"] floating enable
for_window [window_type="notification"] floating enable; border none;
for_window [window_role="pop-up"] floating enable
for_window [window_role="task_dialog"] floating enable

############
# WORKSPACES
############

# Custom workspaces
set $ws_generic "1. "
set $ws_mail "2. "
set $ws_web "3. "
set $ws_dev "4. "
set $ws_chat "5. "
set $ws_news "6. "
set $ws_dl "7. "
set $ws_games "8. "
set $ws_generic2 "9. "
set $ws_terminal "F12. "
# set $ws_media ""

# Assign applications to specific workspaces
assign [class="^Thunderbird$" instance="^Mail$"] $ws_mail
assign [class="^Firefox$" instance="^Navigator$"] $ws_web
assign [class="^vivaldi-stable$" instance="^crx_mpognobbkildjkofajifpdfhcoklimli$"] $ws_web
assign [class="^Gvim$" instance="^gvim$"] $ws_dev
assign [class="^Turpial$" instance="^Turpial$"] $ws_news
assign [class="^Liferea$" instance="^liferea$"] $ws_news
assign [class="^Qbittorrent$" instance="^qbittorrent$"] $ws_dl

# Worspaces in 2nd monitor
workspace $ws_generic output $monitor1
workspace $ws_generic2 output $monitor2
workspace $ws_mail output $monitor2
workspace $ws_news output $monitor2
workspace $ws_terminal output $monitor2
workspace $ws_dl output $monitor2

# Move the current workspace to the next output
# (effectively toggles when you only have two outputs)
bindsym $mod+asterisk move workspace to output right

# Switch to workspace
bindsym $mod+ampersand workspace $ws_generic
bindsym $mod+eacute workspace $ws_mail
bindsym $mod+quotedbl workspace $ws_web
bindsym $mod+apostrophe workspace $ws_dev
bindsym $mod+parenleft workspace $ws_chat
bindsym $mod+minus workspace $ws_news
bindsym $mod+egrave workspace $ws_dl
bindsym $mod+underscore workspace $ws_games
bindsym $mod+ccedilla workspace $ws_generic2
bindsym F12 workspace $ws_terminal

# Move focused container to workspace
bindsym $mod+Shift+ampersand move container to workspace $ws_generic
bindsym $mod+Shift+eacute move container to workspace $ws_mail
bindsym $mod+Shift+quotedbl move container to workspace $ws_web
bindsym $mod+Shift+apostrophe move container to workspace $ws_dev
bindsym $mod+Shift+5 move container to workspace $ws_chat
bindsym $mod+Shift+minus move container to workspace $ws_news
bindsym $mod+Shift+egrave move container to workspace $ws_dl
bindsym $mod+Shift+underscore move container to workspace $ws_games
bindsym $mod+Shift+ccedilla move container to workspace $ws_generic2
bindsym $mod+Shift+F12 move container to workspace $ws_terminal

#######
# I3BAR
#######

# Primary monitor
bar {
	output $monitor1
	position top
	height 24
	status_command i3blocks -c $i3/i3blocks_primary.conf
	tray_output $monitor1
	tray_padding 0
	colors {
		background $bg
		statusline $sl
		separator $inactive_txt
		focused_workspace $blue $blue $focused_txt
		inactive_workspace $bg_light $bg_light $inactive_txt
		urgent_workspace $red $red $focused_txt
	}

	# Control volume with the mouse wheel
	# bindsym button2 $pactl_mute
	# bindsym button4 $pactl_increase
	# bindsym button5 $pactl_decrease
}
bar {
	output $monitor2
	position top
	height 24
	status_command conky -c $i3/i3bar_conkyrc
	tray_output none
	colors {
		background $bg
		statusline $sl
		separator $inactive_txt
		focused_workspace $blue $blue $focused_txt
		inactive_workspace $bg_light $bg_light $inactive_txt
		urgent_workspace $red $red $focused_txt
	}
}

######
# GAPS
######

# Default values:
## inner: Between windows
## outer: Between the edge of the screen and a window
gaps inner 10
gaps outer 0

# Gaps & borders only when we have more than 1 window
smart_gaps on
smart_borders on

#########
# STARTUP
#########

# Disable notebook's keyboard
exec bash /home/k-bag/Projects/Scripts/Divers/toggle_device_state.sh "AT Translated Set 2 Keyboard"

# Set resolution & monitors
exec_always xrandr --output $monitor2 --mode 1280x1024 --pos 1366x0  --gamma 1.4:1.4:1.4 --brightness 1.1 --output $monitor1 --mode 1366x768 --pos 0x0

# Compositor
exec_always compton -cCGf

# Applications
exec clipit
exec nm-applet
exec pasystray
exec xscreensaver -no-splash
exec_always numlockx

# Set background
# exec_always feh --bg-fill --no-fehbg ~/Images/Wallpapers/the-dune_1366x768.jpg
exec_always --no-startup-id nitrogen --restore

# Layouts (fr,eng,ru,ar), toggle it with alt+shift
exec_always --no-startup-id setxkbmap -model pc105 -layout fr,us,ru,ar -option grp:alt_shift_toggle

# Remap ¹ to <
exec_always --no-startup-id xmodmap -e 'keycode 49 = less greater'
